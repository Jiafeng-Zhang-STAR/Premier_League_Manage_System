/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package UserInterface.Fans;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import javax.swing.JOptionPane;
import javax.swing.JSplitPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author yidia
 */
public class RatePlayerJPanel extends javax.swing.JPanel {
    
    JSplitPane SplitPane;
    String email;
    String date = "";
    String homeTeam = "";
    String awayTeam = "";
    /**
     * Creates new form RatePlayerJPanel
     * @param SplitPane
     * @param date
     * @param homeTeam
     * @param awayTeam
     */
    public RatePlayerJPanel(String email,JSplitPane SplitPane, String date,String homeTeam,String awayTeam) {
        this.email = email;
        this.SplitPane = SplitPane;
        this.date = date;
        this.homeTeam = homeTeam; 
        this.awayTeam = awayTeam;
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        btnRatehome = new javax.swing.JButton();
        btnRateAway = new javax.swing.JButton();
        cbbPlayer = new javax.swing.JComboBox<>();
        cbbPass = new javax.swing.JComboBox<>();
        cbbShot = new javax.swing.JComboBox<>();
        cbbDefend = new javax.swing.JComboBox<>();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        btnRate = new javax.swing.JButton();

        btnRatehome.setText("Rate hometeam");
        btnRatehome.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRatehomeActionPerformed(evt);
            }
        });

        btnRateAway.setText("Rate awayteam");
        btnRateAway.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRateAwayActionPerformed(evt);
            }
        });

        cbbPlayer.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Select a player" }));
        cbbPlayer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbbPlayerActionPerformed(evt);
            }
        });

        cbbPass.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Select","1", "2", "3", "4", "5", "6", "7", "8", "9", "10" }));
        cbbPass.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbbPassActionPerformed(evt);
            }
        });

        cbbShot.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Select","1", "2", "3", "4", "5", "6", "7", "8", "9", "10" }));
        cbbShot.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbbShotActionPerformed(evt);
            }
        });

        cbbDefend.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Select","1", "2", "3", "4", "5", "6", "7", "8", "9", "10" }));
        cbbDefend.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbbDefendActionPerformed(evt);
            }
        });

        jLabel1.setText("Player");

        jLabel2.setText("Shot");

        jLabel3.setText("Pass");

        jLabel4.setText("Defend");

        btnRate.setText("Rate");
        btnRate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRateActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(22, 22, 22)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btnRateAway)
                    .addComponent(btnRatehome))
                .addGap(36, 36, 36)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btnRate)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(cbbPlayer, javax.swing.GroupLayout.PREFERRED_SIZE, 126, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel1))
                        .addGap(30, 30, 30)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel3)
                            .addComponent(cbbPass, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel2)
                            .addComponent(cbbShot, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4)
                            .addComponent(cbbDefend, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(111, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(37, 37, 37)
                        .addComponent(btnRatehome)
                        .addGap(34, 34, 34)
                        .addComponent(btnRateAway))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(44, 44, 44)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(jLabel4)
                                .addComponent(jLabel2)
                                .addComponent(jLabel3)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(cbbPlayer, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(cbbPass, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(cbbShot, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(cbbDefend, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addGap(24, 24, 24)
                .addComponent(btnRate)
                .addContainerGap(439, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btnRatehomeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRatehomeActionPerformed
        // TODO add your handling code here:
        populateTable("concat(concat(home_lineup,','),home_alternate)");
    }//GEN-LAST:event_btnRatehomeActionPerformed

    private void btnRateAwayActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRateAwayActionPerformed
        // TODO add your handling code here:
        populateTable("concat(concat(away_lineup,','),away_alternate)");
    }//GEN-LAST:event_btnRateAwayActionPerformed

    private void cbbPassActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbbPassActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cbbPassActionPerformed

    private void cbbShotActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbbShotActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cbbShotActionPerformed

    private void cbbDefendActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbbDefendActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cbbDefendActionPerformed

    private void btnRateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRateActionPerformed
        // TODO add your handling code here:
        try {
                /* create jdbc connection */
                Class.forName("com.mysql.cj.jdbc.Driver");
                
                String url = "jdbc:mysql://localhost:3306/premierleague?zeroDateTimeBehavior=CONVERT_TO_NULL";
                String username = "root";
                
                String password = "abcd1234!";
                Connection connection = DriverManager.getConnection(url, username, password);
                Statement statement = connection.createStatement();
                String playerName =String.valueOf(cbbPlayer.getSelectedItem());
                String pass =String.valueOf(cbbPass.getSelectedItem());
                String shot =String.valueOf(cbbShot.getSelectedItem());
                String defend =String.valueOf(cbbDefend.getSelectedItem());
                /* 在fan_match中增加book记录 */
                String sql ="INSERT INTO fan_rate (email, hometeam, awayteam, date, player, pass, shot, defend) VALUES(\'" + email +"\',\'" + homeTeam +"\',\'" +awayTeam+"\',\'"+ date + "\',\'"+ playerName+ "\',"+ pass + ","+ shot+ ","+ defend +") ON DUPLICATE KEY UPDATE player = \'" + playerName+ "\', pass = "+ pass + ", shot = "+ shot+ ", defend ="+ defend;
                
                int isBooked = statement.executeUpdate(sql);//executeQuery(sql)是查询  executeUpdate是删改
               
               
                if (isBooked ==1){
                    //populateTable(); //Refresh table
                    JOptionPane.showMessageDialog(this, "Rate successfully.");
                }

                //resultSet.close();//close  搭配select使用，其他update什么的都不用
                statement.close();
                connection.close();
                } catch (ClassNotFoundException | SQLException e) {
                    JOptionPane.showMessageDialog(this, "You need to check before book.");
                    return;
            }
    }//GEN-LAST:event_btnRateActionPerformed

    private void cbbPlayerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbbPlayerActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cbbPlayerActionPerformed
    private void populateTable(String teamCatalog) {//teamCatalog对应主队客队
               // TODO add your handling code here:
                                                  
        // TODO add your handling code here:
        
        cbbPlayer.removeAllItems();
        cbbPlayer.addItem("Select a player");
        
        try {
                /* create jdbc connection */
                Class.forName("com.mysql.cj.jdbc.Driver");
                
                String url = "jdbc:mysql://localhost:3306/premierleague?zeroDateTimeBehavior=CONVERT_TO_NULL";
                String username = "root";
                
                String password = "abcd1234!";
                Connection connection = DriverManager.getConnection(url, username, password);
                Statement statement = connection.createStatement();
                
                /* get matchliset in these dates */
                String sqlMatList = "SELECT "+ teamCatalog +" as player_list FROM match_info WHERE date = \'"+ date +"\' and home =\'"+homeTeam +"\'and away =\'"+awayTeam +"\'"; 
                
                ResultSet resultSet = statement.executeQuery(sqlMatList);   //搭配select使用，其他update什么的都不用
                
                if(resultSet.next()){
                    String playerList = String.valueOf(resultSet.getObject("player_list"));
                    String[] names = playerList.split(",");
                    
                    for (int i = 0; i < names.length; i++) {
                        if(names[i].length()!=0){
                            cbbPlayer.addItem(names[i]);
                        }
                        

                    }

                    
                }
                
                resultSet.close();//close  搭配select使用，其他update什么的都不用
                statement.close();
                connection.close();
            } catch (ClassNotFoundException | SQLException e) {
                JOptionPane.showMessageDialog(this, "There is no match");
                return;
            }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnRate;
    private javax.swing.JButton btnRateAway;
    private javax.swing.JButton btnRatehome;
    private javax.swing.JComboBox<String> cbbDefend;
    private javax.swing.JComboBox<String> cbbPass;
    private javax.swing.JComboBox<String> cbbPlayer;
    private javax.swing.JComboBox<String> cbbShot;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    // End of variables declaration//GEN-END:variables
}
